<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>c_and_cpp_language_server_with_emacs.html</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

</head>

<body>

<h1 id="cc-layer">C/C++ Layer</h1>
<p>For current implementation for the <code>c/c++</code> for full
supporting the language.
<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
<strong>Table of Contents</strong></p>
<ul>
<li><a href="#cc-layer">C/C++ Layer</a>
<ul>
<li><a href="#backend-support">BackEnd Support</a></li>
<li><a href="#path-to-lsp-sever-executable">Path to LSP Sever
executable</a></li>
<li><a href="#adding-dependencies-to-clangd">Adding dependencies to
clangd</a></li>
<li><a href="#necessary-tools">Necessary Tools</a>
<ul>
<li><a href="#clang-format">clang-format</a></li>
</ul></li>
<li><a href="#notes-by-eivind-fonn">Notes by Eivind Fonn</a>
<ul>
<li><a href="#11-tell-emacs-how-to-compile">1.1 Tell Emacs How to
Compile</a></li>
</ul></li>
<li><a href="#reference">Reference</a></li>
</ul></li>
</ul>
<!-- markdown-toc end -->
<h2 id="backend-support">BackEnd Support</h2>
<p>There are two <code>backend</code> supports for <code>c-c++</code> in
<code>spacemacs</code>. These are 1. <code>clang</code> which is the
default - if you use the <code>lsp</code> layer. 2. <code>ccls</code>
which is based on the
<code>cquery** is for C/C++/Objective-C language    server</code>
(check<code>Ref-2</code>).</p>
<p><strong>Note</strong> It seems that the <code>ccls</code> is more
powerful that <code>clang</code> but we will use the <code>clang</code>
as its supported by default through the <code>llvm</code>.</p>
<h2 id="path-to-lsp-sever-executable">Path to LSP Sever executable</h2>
<p><code>LSP</code> expects to find the <code>LSP</code> server
executable in your <code>PATH</code>. If you want to specify the
location of an executable then you need to set teh appropriate varaible
as:</p>
<table>
<thead>
<tr class="header">
<th>server</th>
<th>Variable name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>clang</code></td>
<td><code>lsp-client-clang-executable</code></td>
</tr>
<tr class="even">
<td><code>ccls</code></td>
<td><code>ccls-executable</code></td>
</tr>
</tbody>
</table>
<h2 id="adding-dependencies-to-clangd">Adding dependencies to
clangd</h2>
<p>The <code>clangd</code> actually is the <code>lsp</code> server that
used by the <code>nvim</code> and <code>emacs</code> there are two types
of <code>clangd</code> one comes with <code>Apple</code> and one is
installed using <code>Mason</code> in <code>nvim</code>.
<code>Emacs</code> uses the default shipped with <code>Apple</code>
compared to the <code>nvim</code> ones. In summary clangd is a language
server that is commonly used with nvim and emacs for C++ development.
There are two versions of clangd: one that comes pre-installed with
macOS (Apple’s version), and another version that can be installed using
the Mason package manager specifically for nvim setups. - When using
clangd with emacs, it typically relies on the default version that is
shipped with macOS. On the other hand, nvim users can choose to install
and use the clangd version provided by Mason, which offers additional
features and improvements.</p>
<ul>
<li>In summary, both nvim and emacs can utilize clangd as a language
server for C++ development, but the versions used may differ. nvim users
have the option to install the clangd version provided by Mason, while
emacs generally uses the default clangd version shipped with macOS.</li>
<li>You have to add a file called <code>.clangd</code> that will allow
to add the <code>dependencies</code> (e.g. SDL2) I will install
using</li>
</ul>
<ol type="1">
<li>Create a file called <code>generate_clangd_config</code> for the
developement</li>
</ol>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">INCLUDE_PATH</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">/Desktop/devCode/cppDev/CPP_APIs/dependencies/include&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="va">CLANGD_CONFIG</span><span class="op">=</span><span class="st">&quot;.clangd&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if .clangd file exists</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-e</span> <span class="st">&quot;</span><span class="va">$CLANGD_CONFIG</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If .clangd file already exists, update the include path</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sed</span> <span class="at">-i</span> <span class="st">&quot;s|-I.*|-I</span><span class="va">${INCLUDE_PATH}</span><span class="st">|&quot;</span> <span class="st">&quot;</span><span class="va">$CLANGD_CONFIG</span><span class="st">&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If .clangd file doesn&#39;t exist, create it with the include path</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;CompileFlags:&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$CLANGD_CONFIG</span><span class="st">&quot;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;  Add:&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">$CLANGD_CONFIG</span><span class="st">&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;    - -I</span><span class="va">${INCLUDE_PATH}</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">$CLANGD_CONFIG</span><span class="st">&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<h2 id="necessary-tools">Necessary Tools</h2>
<h3 id="clang-format">clang-format</h3>
<p>I have used <code>clang-format</code> to keep on formatting my buffer
on save. Simply</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install clang-format</span></code></pre></div>
<h2 id="notes-by-eivind-fonn">Notes by Eivind Fonn</h2>
<h3 id="tell-emacs-how-to-compile">1.1 Tell Emacs How to Compile</h3>
<ul>
<li>We will set our <code>Spacemacs</code> to infor <code>helm</code>
how to find our <code>make</code> and build our project (assume you
already configured using cmake first).</li>
</ul>
<ol type="1">
<li>You will create a file in the <code>root</code> directory called
<code>.dir-locals.el</code> with the following snippet (assume we want
to run the make in our build/debug directory)</li>
</ol>
<pre class="elisp"><code>((c++-mode (helm-make-build-dir . &quot;build/debug/&quot;)))</code></pre>
<ol start="2" type="1">
<li>The command for <code>helm</code> to find the make is
<code>&lt;space&gt;cc</code> which if you define correctly it will load
all the <code>make</code> file commands at the specified directory
(e.g. debug or release).</li>
<li>Put in your <code>.spacemacs</code> the command in your
<code>(defun dotspacemacs/user-config    ()</code>.</li>
</ol>
<pre class="elisp"><code>;; will look for a file .dir-local-l and load the variable you put, and it will tell the make how to build your C++ project.
(put &#39;helm-make-build-dir &#39;safe-local-variable &#39;stringp)</code></pre>
<ol start="4" type="1">
<li><p>Reboot your <code>clangd</code> by exiting the buffer and you
should have now <code>helm-make-build-dir</code> set to the run the
<code>make</code> file of the <code>./build/debug</code> directory in
your given project (read more [Ref-1].</p></li>
<li><p>I also found that we can use the <code>projectile</code> in the
given project using</p></li>
<li><p>Ensure you have the link to build your project in
<code>CMake</code> <code>Ninja</code> or whatever.</p></li>
<li><p>Run <code>&lt;space&gt;pc</code> this will open a buffer for your
to put your command (e.g. for my AnimationEngine) I use:</p></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Release <span class="at">-S</span> . <span class="at">-B</span> build/release <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ./build/release/ <span class="kw">&amp;&amp;</span> <span class="fu">make</span> <span class="kw">&amp;&amp;</span> <span class="ex">./main</span> <span class="kw">&amp;&amp;</span> <span class="ex">../../</span></span></code></pre></div>
<h2 id="adding-the-clangd-server-indexing">Adding the clangd server
indexing</h2>
<p>I have found that the <code>CMake</code> has the ability to update
the index for our <code>clangd</code> server using the command</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting my compling command for clangd language server</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(<span class="dv">CMAKE_EXPORT_COMPILE_COMMANDS</span> <span class="ot">ON</span>)</span></code></pre></div>
<ul>
<li><p>Now, you can link it to your main root directory as it will be
creatged in the <code>/build/debug</code> or <code>/build/release</code>
for your project based on your <code>CMakeList.txt</code>
specification.</p></li>
<li><p>You can now <code>jump to definition</code>,
<code>syntax highlighting</code>, and all other features of the
<code>clangd</code> server for your current build.</p></li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li>[Ref-1] <a
href="https://www.youtube.com/watch?v=OjbkCEkboA8&amp;t=605s">C/C++ in
Spacemacs - Eivind Fonn</a></li>
<li>[Ref-2] <a href="https://github.com/MaskRay/ccls">ccls language
server GitHub - Repo</a></li>
</ul>

</body>
</html>
